// File: Frontend/cypress/e2e/objetScreen.cy.tsimport Objet from "../../src/Types/Objet";import CategorieObjet from "../../src/Types/CategorieObjet";import EtatEchange from "../../src/Types/EtatEchange";describe('Home Component', () => {    beforeEach(() => {        cy.login();  // Using the custom login command        // Intercept the API call to get the logged user id        cy.intercept('GET', 'http://localhost:3000/api/utilisateurs/trans', {            statusCode: 200,            body: {id: 1},        }).as('fetchUtilisateurId');        // Create a list of objects for the tests        let maxId: number = 0;        const objets: Objet[] = [];        Object.values(CategorieObjet).forEach((categorie: string, index: number) => {                objets.push({                    id: index + 1,                    nom: `Objet ${index + 1}`,                    description: `Description de l'objet ${index + 1}`,                    categorie: categorie,                    idUtilisateur: `user-${index + 2}`,                    utilisateur: `User ${index + 1}`,                    showInput: false,                    enEchange: false,                    idEchange: -1,                });                maxId = index + 1;            });        maxId = 1 + maxId;        // Add 2 objects for the admin user        objets.push({            id: maxId,            nom: `Bureau`,            description: `Description du Bureau`,            categorie: CategorieObjet.MOBILIER,            idUtilisateur: '1',            utilisateur: 'admin',            showInput: false,            enEchange: false,            idEchange: -1,        });        const maxId2 = 1 + maxId;        objets.push({            id: maxId2,            nom: `Table`,            description: `Description de la Table`,            categorie: CategorieObjet.MOBILIER,            idUtilisateur: '1',            utilisateur: 'admin',            showInput: false,            enEchange: false,            idEchange: -1,        });        // Add exchange objects for tests        const echanges = [            {                id: 1,                dateProposition: '2025-03-04T21:54:00.170511',                dateCloture: '2025-03-12T21:54:00.170511',                etatEchange: EtatEchange.ATTENTE,                proprietaireObjetPropose: {                    id: 4,                    pseudo: 'User 3',                    mdp: '',                    mail: '',                    nom: '',                    prenom: '',                },                proprietaireObjetDemande: {                    id: 1,                    pseudo: 'admin',                    mdp: 'admin',                    mail: 'admin@mail.fr',                    nom: 'admin',                    prenom: 'admin',                },                objetPropose: {                    id: 1,                    nom: 'Objet 3',                    categorie: Object.values(CategorieObjet)[2],                    description: 'Description de l\'objet 3',                    dateCreation: '',                    utilisateur: {                        id: 3,                        pseudo: 'User 3',                        mdp: '',                        mail: '',                        nom: '',                        prenom: '',                    },                    dateSuppression: null,                },                objetDemande: {                    id: maxId,                    nom: `Bureau`,                    description: `Description du Bureau`,                    categorie: CategorieObjet.MOBILIER,                    dateCreation: '',                    utilisateur: {                        id: 1,                        pseudo: 'admin',                        mdp: 'admin',                        mail: 'admin@mail.fr',                        nom: 'admin',                        prenom: 'admin',                    },                    dateSuppression: null,                }            },            {                id: 1,                dateProposition: '2025-03-04T21:54:00.170511',                dateCloture: '2025-03-12T21:54:00.170511',                etatEchange: EtatEchange.ATTENTE,                proprietaireObjetPropose: {                    id: 1,                    pseudo: 'admin',                    mdp: 'admin',                    mail: 'admin@mail.fr',                    nom: 'admin',                    prenom: 'admin',                },                proprietaireObjetDemande: {                    id: 5,                    pseudo: 'User 4',                    mdp: '',                    mail: '',                    nom: '',                    prenom: '',                },                objetPropose: {                    id: 4,                    nom: 'Objet 4',                    categorie: Object.values(CategorieObjet)[3],                    description: 'Description de l\'objet 4',                    dateCreation: '',                    utilisateur: {                        id: 5,                        pseudo: 'User 4',                        mdp: '',                        mail: '',                        nom: '',                        prenom: '',                    },                    dateSuppression: null,                },                objetDemande: {                    id: maxId2,                    nom: `Table`,                    description: `Description de la Table`,                    categorie: CategorieObjet.MOBILIER,                    dateCreation: '',                    utilisateur: {                        id: 1,                        pseudo: 'admin',                        mdp: 'admin',                        mail: 'admin@mail.fr',                        nom: 'admin',                        prenom: 'admin',                    },                    dateSuppression: null,                }            }        ];        // Update objects with exchanges        objets.forEach((objet) => {            echanges.forEach((echange) => {                if (objet.id === echange.objetPropose.id || objet.id === echange.objetDemande.id) {                    objet.enEchange = true;                    objet.idEchange = echange.id;                }            });        });        // Intercept the API call to get objects        cy.intercept('GET', 'http://localhost:3000/api/objets', {            statusCode: 200,            body: objets,        }).as('fetchObjets');        // Intercept the API call to get exchanges        cy.intercept('GET', 'http://localhost:3000/api/echanges/all', {            statusCode: 200,            body: echanges,        }).as('fetchEchanges');        // Load the home page        cy.visit('/');        cy.wait(['@fetchUtilisateurId', '@fetchObjets', '@fetchEchanges']);    });    it('should display the header and a list of objects', () => {        // Check welcome header exists        cy.get('header').should('contain', 'Bienvenue ! Vous êtes connecté.');        cy.get('.card').its('length').should('be.gte', 3);        cy.get('.card').first().find('h2').should('contain', 'Objet 1');        cy.get('.card').eq(1).find('h2').should('contain', 'Objet 2');    });    it('should filter objects by search text', () => {        // Type search text that matches "Objet 1"        cy.get('input[placeholder="Rechercher par texte"]').type('Bureau');        // Submit search form        cy.get('form.search-bar').submit();        // Only matching card should be visible        cy.get('.card').should('have.length', 1);        cy.get('.card').first().find('h2').should('contain', 'Bureau');    });    it('should filter objects by user', () => {        // Type search text that matches the user "User 4"        cy.get('input[placeholder="Rechercher par utilisateur"]').type('User 4');        // Submit search form        cy.get('form.search-bar').submit();        // Only matching card should be visible        cy.get('.card').should('have.length', 1);        cy.get('.card').first().find('h2').should('contain', 'Objet 4');    });    it('should filter objects by category', () => {        // Wait for options to render then use the second option        cy.get('select').find('option').then(options => {            expect(options.length).to.be.greaterThan(1);            // Assuming the second option corresponds to a category matching MOBILIER            const optionText = options.eq(1).text().trim();            cy.get('select').select(optionText);        });        // Submit search form        cy.get('form.search-bar').submit();        // Expect 3 cards if category matches MOBILIER        cy.get('.card').should('have.length', 3);    });    it('should reset search filters', () => {        // Set search criteria for text and category        cy.get('input[placeholder="Rechercher par texte"]').type('Bureau');        // Click reset button and check that all 6 objects are shown        cy.get('button[type="reset"]').click();        cy.get('.card').its('length').should('be.gte', 1);    });    it('should logout and redirect to login page', () => {        // Click the logout button in the header (using a regex to match different possible labels)        cy.get('header').contains(/logout|déconnexion/i).click();        // Verify that the URL includes "/login"        cy.url().should('include', '/login');        // Verify token removal from local storage        cy.window().then(win => {            expect(win.localStorage.getItem('authToken')).to.be.null;        });    });});